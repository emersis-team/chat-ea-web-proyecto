(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"293a":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("div",{staticClass:"home-body"},[s("div",{staticClass:"home-right"},[s("div",{staticClass:"chat"},[s("div",{ref:"chatScroll",staticClass:"chat-scroll",attrs:{id:"chatScroll"},on:{scroll:t.onScroll}},t._l(t.mensajes,(function(e){return s("div",{key:e.id,staticClass:"chat-container",class:{"chat-mensaje-propio":e.sender_id==t.userId},attrs:{id:e.id}},[s("div",{staticClass:"chat-mensaje"},[s("label",[t._v(t._s(e.message))])])])})),0),s("div",{staticClass:"chat-bottom"},[s("input",{ref:"inputTexto",attrs:{type:"text",placeholder:"Escribe un mensaje aqu√≠"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enviar()}}}),s("button",{staticClass:"chat-enviar",on:{click:function(e){return t.enviar()}}},[t._v("Enviar")])])])])])])},n=[],i=(s("99af"),s("4160"),s("45fc"),s("159b"),{data:function(){return{mensajes:[],userId:null,primeraPagina:!0,currentPage:0,lastPage:0,mensajeOffset:null}},props:{},computed:{},mounted:function(){this.userId=localStorage.getItem("$userId"),this.getChat(),this.actualizar(),this.mensajes=[],this.$refs.chatScroll.addEventListener("touchmove",this.onScroll)},created:function(){var t=this;this.$eventHub.$on("chat-get",(function(e){return t.getChat(e)}))},methods:{actualizar:function(){var t=this;setTimeout((function(){t.getChat(),t.actualizar()}),3e3)},getChat:function(t){null==t?t=this.$route.params.id:(this.mensajes=[],this.primeraPagina=!0);var e=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+t).then((function(t){1!=e.primeraPagina||e.isOverflown(document.getElementById("chatScroll"))||(e.primeraPagina=!1,e.getChatPage(2));var s=!1;e.lastPage=t.data.messages.last_page,t.data.messages.data.reverse(),t.data.messages.data.forEach((function(t){e.mensajes.some((function(e){return e.id==t.id}))||t.conversation_id!=e.$route.params.id||(e.mensajes.push(t),s=!0)})),1==s&&(e.mensajeOffset=e.mensajes[e.mensajes.length-1],e.scrollToBottom())})).catch((function(t){401==t.response.status&&e.$router.push("/login")}))},getChatPage:function(t){this.mensajeOffset=this.mensajes[0],this.currentPage=t;var e="";null!=t&&(e="?page="+t);var s=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+this.$route.params.id+e).then((function(t){t.data.messages.data.reverse(),s.mensajes=t.data.messages.data.concat(s.mensajes),s.scrollToBottom()})).catch((function(t){401==t.response.status&&s.$router.push("/login")}))},onScroll:function(){var t=this.$refs.chatScroll;t.scrollTop<.1*t.clientHeight&&this.currentPage<this.lastPage&&(this.offset=this.offset+this.limit,this.currentPage++,this.getChatPage(this.currentPage))},scrollToBottom:function(){var t=this;this.$nextTick((function(){document.getElementById("chatScroll").scrollTop=document.getElementById(t.mensajeOffset.id).offsetTop}))},enviar:function(){this.scrollToBottom();var t=this.$refs.inputTexto.value;if(""!=t){this.$refs.inputTexto.value="";var e=new FormData;e.append("message",t),e.append("receiver_id",this.$route.params.user_dest_id);var s=this;this.$axios.post(this.$localurl+"/api/v1/messages",e).then((function(){s.getChat()})).catch((function(t){401==t.response.status&&s.$router.push("/login"),alert("Se produjo un error, reintente")}))}},isOverflown:function(t){return t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth}}}),r=i,o=(s("6514"),s("3bae"),s("2877")),c=Object(o["a"])(r,a,n,!1,null,"52ed952f",null);e["default"]=c.exports},"3bae":function(t,e,s){"use strict";var a=s("a339"),n=s.n(a);n.a},6514:function(t,e,s){"use strict";var a=s("8e3c"),n=s.n(a);n.a},"8e3c":function(t,e,s){},a339:function(t,e,s){}}]);
//# sourceMappingURL=chat.ffbf9682.js.map