{"remainingRequest":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\javi_\\Desktop\\asd\\src\\components\\Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\javi_\\Desktop\\asd\\src\\components\\Chat.vue","mtime":1594300960968},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB2ZWxvY2l0eSBmcm9tICJ2ZWxvY2l0eS1hbmltYXRlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbWVuc2FqZXM6IFtdLAogICAgICB1c2VySWQ6IG51bGwsCiAgICAgIHByaW1lcmFQYWdpbmE6IHRydWUKICAgIH07CiAgfSwKICBwcm9wczogeyBjb252ZXJzYWNpb246IFtPYmplY3RdIH0sCiAgY29tcHV0ZWQ6IHt9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnVzZXJJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCIkdXNlcklkIik7CiAgICB0aGlzLmdldENoYXQoKTsKICAgIHRoaXMuYWN0dWFsaXphcigpOwogICAgdGhpcy5tZW5zYWplcyA9IFtdOwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuJGV2ZW50SHViLiRvbigiY2hhdC1nZXQiLCBpZCA9PiB0aGlzLmdldENoYXQoaWQpKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGFjdHVhbGl6YXIoKSB7CiAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICB0aGF0LmdldENoYXQoKTsKICAgICAgICB0aGF0LmFjdHVhbGl6YXIoKTsKICAgICAgfSwgMzAwMCk7CiAgICB9LAogICAgZ2V0Q2hhdChpZCkgewogICAgICBpZiAoaWQgPT0gbnVsbCkgewogICAgICAgIGlkID0gdGhpcy5jb252ZXJzYWNpb24uaWQ7CiAgICAgIH0KICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICB0aGlzLiRheGlvcwogICAgICAgIC5nZXQodGhpcy4kbG9jYWx1cmwgKyAiL2FwaS92MS9tZXNzYWdlcy8iICsgaWQpCiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIGlmICh0aGF0LnByaW1lcmFQYWdpbmEgPT0gdHJ1ZSkgewogICAgICAgICAgICB0aGF0LnByaW1lcmFQYWdpbmEgPSBmYWxzZTsKICAgICAgICAgICAgdGhhdC5nZXRDaGF0UGFnZSgyKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzY3JvbGxlYXIgPSBmYWxzZTsKICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZXMuZGF0YS5yZXZlcnNlKCk7CiAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2VzLmRhdGEuZm9yRWFjaChtID0+IHsKICAgICAgICAgICAgaWYgKCF0aGF0Lm1lbnNhamVzLnNvbWUobWVuc2FqZSA9PiBtZW5zYWplLmlkID09IG0uaWQpKSB7CiAgICAgICAgICAgICAgdGhhdC5tZW5zYWplcy5wdXNoKG0pOwogICAgICAgICAgICAgIHNjcm9sbGVhciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHNjcm9sbGVhciA9PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRTY3JvbGwiKTsKICAgICAgICAgICAgdmVsb2NpdHkoZWxlbSwgInNjcm9sbCIsIHsKICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwMCwKICAgICAgICAgICAgICBvZmZzZXQ6IHRoaXMuJHJlZnMuY2hhdFNjcm9sbC5vZmZzZXRUb3AKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZnVuY3Rpb24oKSB7fSk7CiAgICB9LAogICAgZ2V0Q2hhdFBhZ2UocGFnaW5hKSB7CiAgICAgIHZhciBwYWcgPSAiIjsKICAgICAgaWYgKHBhZ2luYSAhPSBudWxsKSB7CiAgICAgICAgcGFnID0gIj9wYWdlPSIgKyBwYWdpbmE7CiAgICAgIH0KICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICB0aGlzLiRheGlvcwogICAgICAgIC5nZXQodGhpcy4kbG9jYWx1cmwgKyAiL2FwaS92MS9tZXNzYWdlcy8iICsgdGhpcy5jb252ZXJzYWNpb24uaWQgKyBwYWcpCiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZXMuZGF0YS5yZXZlcnNlKCk7CiAgICAgICAgICB0aGF0Lm1lbnNhamVzID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlcy5kYXRhLmNvbmNhdCh0aGF0Lm1lbnNhamVzKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaChmdW5jdGlvbigpIHt9KTsKICAgIH0sCiAgICBlbnZpYXIoKSB7CiAgICAgIHZhciB0ZXh0byA9IHRoaXMuJHJlZnMuaW5wdXRUZXh0by52YWx1ZTsKICAgICAgaWYgKHRleHRvICE9ICIiKSB7CiAgICAgICAgdGhpcy5tZW5zYWplcy5wdXNoKHsKICAgICAgICAgIGlkOiAwLAogICAgICAgICAgc2VuZGVyX2lkOiB0aGlzLnVzZXJJZCwKICAgICAgICAgIG1lc3NhZ2U6IHRleHRvCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy4kcmVmcy5pbnB1dFRleHRvLnZhbHVlID0gIiI7CiAgICAgICAgdmFyIGRhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICBkYXRhLmFwcGVuZCgibWVzc2FnZSIsIHRleHRvKTsKICAgICAgICBkYXRhLmFwcGVuZCgicmVjZWl2ZXJfaWQiLCB0aGlzLmNvbnZlcnNhY2lvbi51c2VyX2Rlc3QuaWQpOwogICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAucG9zdCh0aGlzLiRsb2NhbHVybCArICIvYXBpL3YxL21lc3NhZ2VzIiwgZGF0YSkKICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge30pCiAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGFsZXJ0KCJTZSBwcm9kdWpvIHVuIGVycm9yLCByZWludGVudGUiKTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Chat.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"chat\">\n    <div id=\"chatScroll\" class=\"chat-scroll\" ref=\"chatScroll\">\n      <div\n        v-for=\"mensaje in mensajes\"\n        :key=\"mensaje.id\"\n        class=\"chat-container\"\n        v-bind:class=\"{ 'chat-mensaje-propio': mensaje.sender_id == userId }\"\n      >\n        <div class=\"chat-mensaje\">\n          <label>{{ mensaje.message }}</label>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"chat-bottom\">\n      <input type=\"text\" placeholder=\"Escribe un mensaje aquÃ­\" ref=\"inputTexto\" />\n      <button class=\"chat-enviar\" @click=\"enviar()\">Enviar</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport velocity from \"velocity-animate\";\n\nexport default {\n  data() {\n    return {\n      mensajes: [],\n      userId: null,\n      primeraPagina: true\n    };\n  },\n  props: { conversacion: [Object] },\n  computed: {},\n  mounted() {\n    this.userId = localStorage.getItem(\"$userId\");\n    this.getChat();\n    this.actualizar();\n    this.mensajes = [];\n  },\n  created() {\n    this.$eventHub.$on(\"chat-get\", id => this.getChat(id));\n  },\n  methods: {\n    actualizar() {\n      var that = this;\n      setTimeout(function() {\n        that.getChat();\n        that.actualizar();\n      }, 3000);\n    },\n    getChat(id) {\n      if (id == null) {\n        id = this.conversacion.id;\n      }\n      var that = this;\n      this.$axios\n        .get(this.$localurl + \"/api/v1/messages/\" + id)\n        .then(function(response) {\n          if (that.primeraPagina == true) {\n            that.primeraPagina = false;\n            that.getChatPage(2);\n          }\n          var scrollear = false;\n          response.data.messages.data.reverse();\n          response.data.messages.data.forEach(m => {\n            if (!that.mensajes.some(mensaje => mensaje.id == m.id)) {\n              that.mensajes.push(m);\n              scrollear = true;\n            }\n          });\n          if (scrollear == true) {\n            var elem = document.getElementById(\"chatScroll\");\n            velocity(elem, \"scroll\", {\n              duration: 1000,\n              offset: this.$refs.chatScroll.offsetTop\n            });\n          }\n        })\n        .catch(function() {});\n    },\n    getChatPage(pagina) {\n      var pag = \"\";\n      if (pagina != null) {\n        pag = \"?page=\" + pagina;\n      }\n      var that = this;\n      this.$axios\n        .get(this.$localurl + \"/api/v1/messages/\" + this.conversacion.id + pag)\n        .then(function(response) {\n          response.data.messages.data.reverse();\n          that.mensajes = response.data.messages.data.concat(that.mensajes);\n        })\n        .catch(function() {});\n    },\n    enviar() {\n      var texto = this.$refs.inputTexto.value;\n      if (texto != \"\") {\n        this.mensajes.push({\n          id: 0,\n          sender_id: this.userId,\n          message: texto\n        });\n        this.$refs.inputTexto.value = \"\";\n        var data = new FormData();\n        data.append(\"message\", texto);\n        data.append(\"receiver_id\", this.conversacion.user_dest.id);\n        this.$axios\n          .post(this.$localurl + \"/api/v1/messages\", data)\n          .then(function() {})\n          .catch(function() {\n            alert(\"Se produjo un error, reintente\");\n          });\n      }\n    }\n  }\n};\n</script>\n\n<style scoped src=\"../assets/css/components/chat.css\"></style>\n"]}]}