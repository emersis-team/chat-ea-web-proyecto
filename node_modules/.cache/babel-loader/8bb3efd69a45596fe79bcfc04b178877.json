{"remainingRequest":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\javi_\\Desktop\\asd\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\javi_\\Desktop\\asd\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\javi_\\Desktop\\asd\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\javi_\\Desktop\\asd\\src\\components\\Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\javi_\\Desktop\\asd\\src\\components\\Chat.vue","mtime":1594300960968},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\javi_\\Desktop\\asd\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCB2ZWxvY2l0eSBmcm9tICJ2ZWxvY2l0eS1hbmltYXRlIjsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBtZW5zYWplczogW10sCiAgICAgIHVzZXJJZDogbnVsbCwKICAgICAgcHJpbWVyYVBhZ2luYTogdHJ1ZQogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBjb252ZXJzYWNpb246IFtPYmplY3RdCiAgfSwKICBjb21wdXRlZDoge30sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHRoaXMudXNlcklkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oIiR1c2VySWQiKTsKICAgIHRoaXMuZ2V0Q2hhdCgpOwogICAgdGhpcy5hY3R1YWxpemFyKCk7CiAgICB0aGlzLm1lbnNhamVzID0gW107CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICB0aGlzLiRldmVudEh1Yi4kb24oImNoYXQtZ2V0IiwgZnVuY3Rpb24gKGlkKSB7CiAgICAgIHJldHVybiBfdGhpcy5nZXRDaGF0KGlkKTsKICAgIH0pOwogIH0sCiAgbWV0aG9kczogewogICAgYWN0dWFsaXphcjogZnVuY3Rpb24gYWN0dWFsaXphcigpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGF0LmdldENoYXQoKTsKICAgICAgICB0aGF0LmFjdHVhbGl6YXIoKTsKICAgICAgfSwgMzAwMCk7CiAgICB9LAogICAgZ2V0Q2hhdDogZnVuY3Rpb24gZ2V0Q2hhdChpZCkgewogICAgICBpZiAoaWQgPT0gbnVsbCkgewogICAgICAgIGlkID0gdGhpcy5jb252ZXJzYWNpb24uaWQ7CiAgICAgIH0KCiAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgdGhpcy4kYXhpb3MuZ2V0KHRoaXMuJGxvY2FsdXJsICsgIi9hcGkvdjEvbWVzc2FnZXMvIiArIGlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmICh0aGF0LnByaW1lcmFQYWdpbmEgPT0gdHJ1ZSkgewogICAgICAgICAgdGhhdC5wcmltZXJhUGFnaW5hID0gZmFsc2U7CiAgICAgICAgICB0aGF0LmdldENoYXRQYWdlKDIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNjcm9sbGVhciA9IGZhbHNlOwogICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZXMuZGF0YS5yZXZlcnNlKCk7CiAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlcy5kYXRhLmZvckVhY2goZnVuY3Rpb24gKG0pIHsKICAgICAgICAgIGlmICghdGhhdC5tZW5zYWplcy5zb21lKGZ1bmN0aW9uIChtZW5zYWplKSB7CiAgICAgICAgICAgIHJldHVybiBtZW5zYWplLmlkID09IG0uaWQ7CiAgICAgICAgICB9KSkgewogICAgICAgICAgICB0aGF0Lm1lbnNhamVzLnB1c2gobSk7CiAgICAgICAgICAgIHNjcm9sbGVhciA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChzY3JvbGxlYXIgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdFNjcm9sbCIpOwogICAgICAgICAgdmVsb2NpdHkoZWxlbSwgInNjcm9sbCIsIHsKICAgICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICAgIG9mZnNldDogdGhpcy4kcmVmcy5jaGF0U2Nyb2xsLm9mZnNldFRvcAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7CiAgICB9LAogICAgZ2V0Q2hhdFBhZ2U6IGZ1bmN0aW9uIGdldENoYXRQYWdlKHBhZ2luYSkgewogICAgICB2YXIgcGFnID0gIiI7CgogICAgICBpZiAocGFnaW5hICE9IG51bGwpIHsKICAgICAgICBwYWcgPSAiP3BhZ2U9IiArIHBhZ2luYTsKICAgICAgfQoKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICB0aGlzLiRheGlvcy5nZXQodGhpcy4kbG9jYWx1cmwgKyAiL2FwaS92MS9tZXNzYWdlcy8iICsgdGhpcy5jb252ZXJzYWNpb24uaWQgKyBwYWcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlcy5kYXRhLnJldmVyc2UoKTsKICAgICAgICB0aGF0Lm1lbnNhamVzID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlcy5kYXRhLmNvbmNhdCh0aGF0Lm1lbnNhamVzKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge30pOwogICAgfSwKICAgIGVudmlhcjogZnVuY3Rpb24gZW52aWFyKCkgewogICAgICB2YXIgdGV4dG8gPSB0aGlzLiRyZWZzLmlucHV0VGV4dG8udmFsdWU7CgogICAgICBpZiAodGV4dG8gIT0gIiIpIHsKICAgICAgICB0aGlzLm1lbnNhamVzLnB1c2goewogICAgICAgICAgaWQ6IDAsCiAgICAgICAgICBzZW5kZXJfaWQ6IHRoaXMudXNlcklkLAogICAgICAgICAgbWVzc2FnZTogdGV4dG8KICAgICAgICB9KTsKICAgICAgICB0aGlzLiRyZWZzLmlucHV0VGV4dG8udmFsdWUgPSAiIjsKICAgICAgICB2YXIgZGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGRhdGEuYXBwZW5kKCJtZXNzYWdlIiwgdGV4dG8pOwogICAgICAgIGRhdGEuYXBwZW5kKCJyZWNlaXZlcl9pZCIsIHRoaXMuY29udmVyc2FjaW9uLnVzZXJfZGVzdC5pZCk7CiAgICAgICAgdGhpcy4kYXhpb3MucG9zdCh0aGlzLiRsb2NhbHVybCArICIvYXBpL3YxL21lc3NhZ2VzIiwgZGF0YSkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgYWxlcnQoIlNlIHByb2R1am8gdW4gZXJyb3IsIHJlaW50ZW50ZSIpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"chat\">\n    <div id=\"chatScroll\" class=\"chat-scroll\" ref=\"chatScroll\">\n      <div\n        v-for=\"mensaje in mensajes\"\n        :key=\"mensaje.id\"\n        class=\"chat-container\"\n        v-bind:class=\"{ 'chat-mensaje-propio': mensaje.sender_id == userId }\"\n      >\n        <div class=\"chat-mensaje\">\n          <label>{{ mensaje.message }}</label>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"chat-bottom\">\n      <input type=\"text\" placeholder=\"Escribe un mensaje aquÃ­\" ref=\"inputTexto\" />\n      <button class=\"chat-enviar\" @click=\"enviar()\">Enviar</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport velocity from \"velocity-animate\";\n\nexport default {\n  data() {\n    return {\n      mensajes: [],\n      userId: null,\n      primeraPagina: true\n    };\n  },\n  props: { conversacion: [Object] },\n  computed: {},\n  mounted() {\n    this.userId = localStorage.getItem(\"$userId\");\n    this.getChat();\n    this.actualizar();\n    this.mensajes = [];\n  },\n  created() {\n    this.$eventHub.$on(\"chat-get\", id => this.getChat(id));\n  },\n  methods: {\n    actualizar() {\n      var that = this;\n      setTimeout(function() {\n        that.getChat();\n        that.actualizar();\n      }, 3000);\n    },\n    getChat(id) {\n      if (id == null) {\n        id = this.conversacion.id;\n      }\n      var that = this;\n      this.$axios\n        .get(this.$localurl + \"/api/v1/messages/\" + id)\n        .then(function(response) {\n          if (that.primeraPagina == true) {\n            that.primeraPagina = false;\n            that.getChatPage(2);\n          }\n          var scrollear = false;\n          response.data.messages.data.reverse();\n          response.data.messages.data.forEach(m => {\n            if (!that.mensajes.some(mensaje => mensaje.id == m.id)) {\n              that.mensajes.push(m);\n              scrollear = true;\n            }\n          });\n          if (scrollear == true) {\n            var elem = document.getElementById(\"chatScroll\");\n            velocity(elem, \"scroll\", {\n              duration: 1000,\n              offset: this.$refs.chatScroll.offsetTop\n            });\n          }\n        })\n        .catch(function() {});\n    },\n    getChatPage(pagina) {\n      var pag = \"\";\n      if (pagina != null) {\n        pag = \"?page=\" + pagina;\n      }\n      var that = this;\n      this.$axios\n        .get(this.$localurl + \"/api/v1/messages/\" + this.conversacion.id + pag)\n        .then(function(response) {\n          response.data.messages.data.reverse();\n          that.mensajes = response.data.messages.data.concat(that.mensajes);\n        })\n        .catch(function() {});\n    },\n    enviar() {\n      var texto = this.$refs.inputTexto.value;\n      if (texto != \"\") {\n        this.mensajes.push({\n          id: 0,\n          sender_id: this.userId,\n          message: texto\n        });\n        this.$refs.inputTexto.value = \"\";\n        var data = new FormData();\n        data.append(\"message\", texto);\n        data.append(\"receiver_id\", this.conversacion.user_dest.id);\n        this.$axios\n          .post(this.$localurl + \"/api/v1/messages\", data)\n          .then(function() {})\n          .catch(function() {\n            alert(\"Se produjo un error, reintente\");\n          });\n      }\n    }\n  }\n};\n</script>\n\n<style scoped src=\"../assets/css/components/chat.css\"></style>\n"],"sourceRoot":"src/components"}]}